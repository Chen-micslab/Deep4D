# Deep4D
## Introduction
Deep4D is a deep learning model which could predict ion mobility, retention time, fragment intensity and charge state of peptide to generate in silico 4D library for 4D DIA proteomics and phosphoproteomics.
If necessary, Deep4D can also provide separate ion mobility, retention time, fragment intensity or charge state prediction functions.
## Guide to generate a 4D library 
### 1. Prepare peptide list
The peptide list should be stored in a comma-separated values (CSV) file including two column:'Peptide', 'Charge'. This CSV file should be stored at the directory 'Deep4D/Deep4D/dataset/data'
```
Peptide,Charge
AAAAAAAAGAFAGR,2
aAAAAAAAAVPSAAGR,2
AAAAAATAPPSPGPAQPGPR,2
AAAAALeSQQQSLQER,2
AAAAAWEEPSSGNGTAR,2
AAAAFVLsANENNIALFK,2
```
The PTM contain phosphorylation of serine, threonine and tyrosine, oxidation of methionine and acetylation on N-terminal of proteins. They are represented as: S(phos)--s, T(phos)--t, Y(phos)--y, M(oxid)--e, acetylation--a.

### 2. Generate 4D library
The generation of 4D library is executed through this script 'Deep4D/Deep4D/predict_4d_library.py'. The parameters of ccs model, rt model and msms model are required and should be stored as 'pth' file at the directory 'Deep4D/Deep4D/checkpoint'.   
Run `'Deep4D/Deep4D/predict_4d_library.py'`.  
Example:
```
python predict_4d_library.py --filename 'peptide_list.csv' --load_msms_param_dir './checkpoint/msms_model.pth' --load_ccs_param_dir './checkpoint/ccs_model.pth' --load_rt_param_dir './checkpoint/rt_model.pth' --maxcharge 3 --type 'DeepDIA' --library 'Peaks' --slice 3 --batch_size 50 
```
#### Description of argparse:  
--filename: the 'csv' file of peptide list  
--load_msms_param_dir: the file directory of msms model  
--load_ccs_param_dir: the file directory of ccs model  
--load_rt_param_dir: the file directory of rt model  
--maxcharge: the maximum charge in peptide list, the charge range would in [2,maxcharge], the recommended range is [2,4]  
--type: The neutral loss type of msms spectrum. Now Deep4D contains two type 'DeepDIA' and 'DeepPhospho'. 'DeepDIA': NH3 and H20, 'DeepPhospho': H3PO4.  
--library: The type of 4D library. Now Deep4D contains only 'Peaks' which support PEAKS Online software.    
--slice: If the scale of  peptide list is too large for your compute, you can slice the list. It should be set to an integer greater than 0.  
--batch_size: The batch size.  
#### 4D Library formats
The formats generated by Deep4D now contain two type: 'Peaks' and 'Normal'. 'Peaks': tab-separated (.tsv), 'Normal': comma-separated (.csv).   
1. 'Normal': It contains all the necessary information of a conventional spectrum library. The columns:
- **Peptide**: Modified peptide
- **Charge**: Charge state of peptide
- **m_z**: m/z of peptide
- **RT**: Retention time
- **IM**: Ion mobility
- **FI.Charge**: Charge state of fragment 
- **FI.FrgType**: b or y type of fragment
- **FI.FrgNum**: Series number of fragment
- **FI.LossType**: Neutral loss typep of fragment
- **FI.Intensity**: Intensity of fragment
- **FI.m_z**: m/z of fragment
## Guide to train the model
### a. Train ccs model  
#### 1.Prepare the training data
The training data should be stored in a comma-separated values (CSV) file including two column:'Peptide', 'Charge', 'CCS'. This CSV file should be stored at the directory 'Deep4D/Deep4D/dataset/data'
```
Peptide,Charge,CCS,RT
aAADIASK,1,218.8175142,6.141666667
aAAQGEPQVQFK,1,264.0467586,34.835
GHFNIQPNKK,3,433.9747944,12.24
IAILGFAFKK,2,382.8162064,51.305
KIGEEEIQKPEEK,2,415.801214,16.84666667
LQAEIKR,2,323.5481144,12.26
```
#### 2.Encoding peptide
